const _find=(e,t=document)=>{let n=[];return"string"==typeof e?n=t.querySelectorAll(e):e instanceof Element?n=[e]:e instanceof NodeList?n=e:(e instanceof Window||e instanceof Document)&&(n=[e]),0===n.length&&_libbyLog("[_find] No elements found:",e,t),n},_el=(e,t=document)=>_find(e,t)[0]||null,_els=(e,t=document)=>_find(e,t),_remove=(e,t=document)=>{const n=_find(e,t);if(0===n.length)return!1;try{return n.forEach(e=>e.remove()),_libbyLog("[_remove] Elements removed:",n),!0}catch(e){_libbyLog("[_remove] Error removing elements:",e,n)}return!1},_dispatch=(e,t,n={},o=0)=>{const i=_find(e)[0];if(i)try{o?setTimeout(function(){i.dispatchEvent(new CustomEvent(t,{detail:n}))},o):i.dispatchEvent(new CustomEvent(t,{detail:n})),_libbyLog("[_dispatch]",t,o)}catch(e){_libbyLog("[_dispatch] Error dispatching event:",e,t,o,i)}},_on=(e,t,n)=>{const o=_find(e);if(0===o.length)return;const i=[];return o.forEach(e=>{const o=e=>{n(e,e.detail)};e.addEventListener(t,o),_libbyLog("[_on] Added event listener:",t),i.push({remove:function(){e.removeEventListener(t,o)}})}),i},_once=(e,t,n)=>{const o=_find(e);if(0===o.length)return;const i=[];return o.forEach(e=>{const o=e=>{n(e,e.detail)};e.addEventListener(t,o,{once:!0}),_libbyLog("[_once] Added event listener:",t),i.push({remove:function(){e.removeEventListener(t,o)}})}),i},_is=(e,t)=>{const n=_find(e)[0];if(n)return n.matches(t)},_toggleClass=(e,t,n=null)=>{const o=_find(e);if(0===o.length)return;const i=Array.isArray(t)?t:t.split(/\s+/);o.forEach(e=>{i.forEach(t=>{null===n?e.classList.toggle(t):n?e.classList.add(t):e.classList.remove(t)})})},_addClass=(e,t)=>{_toggleClass(e,t,!0)},_removeClass=(e,t)=>{_toggleClass(e,t,!1)},_parseHTML=(e,t=!0)=>{if(!e)return _libbyLog("[_parseHTML] Invalid string:",e),null;if(t){const t=document.createElement("textarea");t.innerHTML=e,e=t.value}return(new DOMParser).parseFromString(e,"text/html").body.innerHTML},_getUrlParam=(e,t=null)=>{const n=new URLSearchParams(window.location.search).get(e);return null!==n?n:t},_debounce=(e,t,n=!1)=>{var o;return _libbyLog("[_debounce] Debounce event set",t),function(){var i=this,r=arguments;n&&e.apply(i,r),clearTimeout(o),o=setTimeout(function(){o=null,e.apply(i,r)},t)}},_inViewport=(e,t,n=window.innerHeight/2)=>{const o=_find(e)[0],i=t?_find(t)[0]:window;if(!o||!i)return!1;const r=o.getBoundingClientRect();if(t===window)return r.top<window.innerHeight-n&&r.bottom>0&&r.left<window.innerWidth&&r.right>0;{const e=i.getBoundingClientRect();return r.top<e.bottom-n&&r.bottom>e.top&&r.left<e.right&&r.right>e.left}},_persist=(e,t=null,n=604800)=>{if("string"!=typeof e||""===e.trim())return void _libbyLog("[_persist] Invalid key:",e);if(null===t)return _persistGet(e);const o="session"===n?sessionStorage:localStorage,i={data:t,expiration:"number"==typeof n?Date.now()+n:n};try{if(o)o.setItem(e,JSON.stringify(i));else{const t=n&&"number"==typeof n?`; expires=${new Date(Date.now()+n).toUTCString()}`:"";document.cookie=`${e}=${encodeURIComponent(JSON.stringify(i))}${t}; path=/`}_libbyLog("[_persistGet] Stored data:",e,i)}catch(e){_libbyLog("[_persist] Error storing data:",e)}},_persistGet=e=>{if("string"!=typeof e||""===e.trim())return void _libbyLog("[_persistGet] Invalid key:",e);let t=null,n="sessionStorage";try{let o=sessionStorage?sessionStorage.getItem(e):null;if(o){if(t=JSON.parse(o),t&&"session"===t.expiration)return _libbyLog(`[_persistGet] Retrieved ${n} data:`,e,t),t.data;t=null}if(!t&&localStorage&&(n="localStorage",o=localStorage?localStorage.getItem(e):null,o&&(t=JSON.parse(o))),!t){n="cookie";const o=document.cookie.split("; ").find(t=>t.startsWith(`${e}=`));o&&(t=JSON.parse(decodeURIComponent(o.split("=")[1])))}}catch(e){_libbyLog("[_persistGet] Error retrieving data:",e)}return t&&t.expiration&&t.expiration<Date.now()?(_persistRemove(e),null):(_libbyLog(`[_persistGet] Retrieved ${n} data:`,e,t),t?t.data:null)},_persistRemove=e=>{if("string"==typeof e&&""!==e.trim())try{sessionStorage&&sessionStorage.removeItem(e),localStorage&&localStorage.removeItem(e),document.cookie=`${e}=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/`,_libbyLog("[_persistGet] Removed data:",e)}catch(e){_libbyLog("[_persistRemove] Error removing data:",e)}else _libbyLog("[_persistRemove] Invalid key:",e)},_libbyLog=(...e)=>{if(_is("body",".dev"))return console.debug(...e)},_libbyInit=()=>{window._libbyReady||(window._debounce=_debounce,window._dispatch=_dispatch,window._find=_find,window._el=_el,window._els=_els,window._remove=_remove,window._on=_on,window._once=_once,window._is=_is,window._toggleClass=_toggleClass,window._addClass=_addClass,window._removeClass=_removeClass,window._parseHTML=_parseHTML,window._getUrlParam=_getUrlParam,window._inViewport=_inViewport,window._persist=_persist,window._persistGet=_persistGet,window._persistRemove=_persistRemove,window._libbyLog=_libbyLog)};_libbyInit(),document.addEventListener("DOMContentLoaded",function(e){window._libbyReady||(window._libbyReady=!0,_dispatch(window,"libby:ready"))});export{_find,_el,_els,_remove,_dispatch,_on,_once,_is,_toggleClass,_addClass,_removeClass,_parseHTML,_getUrlParam,_debounce,_inViewport,_persist,_persistGet,_persistRemove,_libbyLog,_libbyInit};